---
title: Pr√©sentation du Starter Blog Tailwind Next-js V 2.0
date: '2023-08-05'
lastmod: '2023-08-05'
language: fr
localeid: 'releasev2'
categories: ['code']
tags: ['next-js', 'tailwind', 'guide', 'fonctionnalites']
image: '/images/image-placeholder.png'
draft: false
summary: Pr√©sentation du mod√®le Starter Blog Tailwind Next-js v2.0, refactoris√© avec le r√©pertoire Nextjs App et la configuration des composants React Server. D√©couvrez les nouvelles fonctionnalit√©s et comment migrer √† partir de la V1.
---

## Introduction

Bienvenue dans le nouveau mod√®le de Starter Blog Tailwind Nextjs v2.0. Cette version est une refactorisation majeure de la base de code pour prendre en charge le r√©pertoire Nextjs App et les composants React Server. Lisez la suite pour d√©couvrir les nouvelles fonctionnalit√©s et comment migrer depuis la V1.

<TOCInline toc={props.toc} exclude="Introduction" />

## De la V1 √† la V2

![Github Traffic](images/blog/github-traffic.png)

Le mod√®le a √©t√© publi√© pour la premi√®re fois en janvier 2021 et a depuis √©t√© utilis√© par des milliers d'utilisateurs. Il a √©t√© pr√©sent√© sur [Mod√®les Next.js](https://vercel.com/templates/next.js/tailwind-css-starter-blog), [Tailwind Awesome](https://www.tailwindawesome.com/resources /tailwind-nextjs-starter-blog) parmi d'autres sites de r√©f√©rencement. Il attire chaque jour plus de 200 visiteurs uniques, avec entre 1 500 et 2 000 pages vues, avec 13 000 forks et de nombreux autres clones.

Un grand merci √† la communaut√© d'utilisateurs et de contributeurs pour avoir fait de ce mod√®le un succ√®s ! J'ai cr√©√© un petit montage vid√©o des blogs (tout en nettoyant la liste dans le readme) pour mettre en valeur la diversit√© des blogs cr√©√©s gr√¢ce au mod√®le et c√©l√©brer cette √©tape importante:

<video controls>
  <source
    src="https://github-production-user-asset-6210df.s3.amazonaws.com/28362229/258559849-2124c81f-b99d-4431-839c-347e01a2616c.webm"
    type="video/webm"
  />
</video>

La version 2 s'appuie sur le succ√®s de la version pr√©c√©dente et introduit de nombreuses nouvelles fonctionnalit√©s et am√©liorations. La base de code a √©t√© refactoris√©e pour prendre en charge l'app router de Next.js et les composants React server. Markdown / MDX est d√©sormais trait√© √† l'aide de Contentlayer, un SDK de contenu "typesafe" gr√¢ce √† typescript, qui valide et transforme votre contenu en donn√©es JSON de type s√©curis√©. Il s'int√®gre √† Pliny, une nouvelle biblioth√®que qui fournit des composants Next.js pr√™ts √† l'emploi pour am√©liorer votre site statique avec des analyses, des commentaires et un abonnement √† la newsletter. Un nouveau composant de recherche avec palette de commandes (‚åò-k) a √©galement √©t√© ajout√© au mod√®le.

Plongeons dans les nouvelles fonctionnalit√©s et am√©liorations de la V2.

## R√©pertoire d'application Next.js et composants Server React

Maintenant que l'[app router de Next.js](https://nextjs.org/docs/app) est enfin stable et est principalement compatible avec Page Router, la base de code a √©t√© migr√©e vers une nouvelle configuration. Cela permet une approche de rendu hybride, avec l'utilisation de composants React Server g√©n√©r√©s c√¥t√© serveur pour des chargements de pages plus rapides et des tailles de bundle plus petites, tout en conservant la possibilit√© d'int√©grer les composants React c√¥t√© client pour l'interactivit√©.[^1]

Avec des possibilit√©s suppl√©mentaires survient un [nouveau paradigme](https://nextjs.org/docs/getting-started/react-essentials) et son lot d'apprentissage. J'ai migr√© la base de code pour utiliser au maximum les nouvelles fonctionnalit√©s. Cela inclut des modifications dans la structure des dossiers, la division des composants en composants serveur et clients, l'exploitation de la r√©cup√©ration de donn√©es c√¥t√© serveur et l'utilisation des [m√©tadonn√©es] recommand√©es (https://nextjs.org/docs/app/building-your-application/optimizing/metadata ), API pour le SEO.

Bien que cela simplifie dans une certaine mesure la base de code, cela rend aussi la migration √† partir de l'ancienne base de code plus difficile. Si vous souhaitez migrer, je vous recommande de partir d'un nouveau mod√®le et de copier vos personnalisations et votre contenu existant. Consultez la section [recommandations de migration](#migration-recommendations) pour plus de d√©tails.

## Typescript First

La base de code a √©t√© migr√©e vers Typescript. Alors que la version pr√©c√©dente du mod√®le √©tait disponible en Javascript et Typescript, j'ai d√©cid√© de r√©duire la charge de maintenance et de me concentrer sur Typescript. Cela permet √©galement une meilleure v√©rification de type et une meilleure compl√©tion du code dans les IDE.

Typescript correspond √©galement parfaitement √† notre nouveau processeur remark s√©curis√© - Contentlayer.

## Contentlayer

[Contentlayer](https://www.contentlayer.dev/) est un SDK de contenu qui valide et transforme votre contenu en donn√©es JSON de type s√©curis√© que vous pouvez facilement importer dans votre application. Cela facilite le travail avec des fichiers markdown locaux ou MDX. Cela permets de remplacer ¬´MDX-bundler¬ª et notre propre workflow de traitement markdown.

Tout d'abord, une source de contenu est d√©finie, sp√©cifiant le nom du type de document, la source o√π il se trouve ainsi que les champs de premier plan et tous les champs calcul√©s suppl√©mentaires qui doivent √™tre g√©n√©r√©s dans le cadre du processus.

```ts:contentlayer.config.ts
export const Blog = defineDocumentType(() => ({
  name: 'Blog',
  filePathPattern: 'blog/**/*.mdx',
  contentType: 'mdx',
  fields: {
    title: { type: 'string', required: true },
    date: { type: 'date', required: true },
    tags: { type: 'list', of: { type: 'string' }, default: [] },
    ...
  },
  computedFields: {
    readingTime: { type: 'json', resolve: (doc) => readingTime(doc.body.raw) },
    slug: {
      type: 'string',
      resolve: (doc) => doc._raw.flattenedPath.replace(/^.+?(\/)/, ''),
    }
    ...
  },
}))
```

Contentlayer traite ensuite les fichiers MDX avec les plugins de Remark ou de Rehype de markdown souhait√©s, valide le sch√©ma, g√©n√®re des d√©finitions de type et g√©n√®re des fichiers json qui peuvent √™tre facilement import√©s dans nos pages. Le rechargement √† chaud est pr√™t √† l'emploi, de sorte que les modifications apport√©es aux fichiers markdown seront imm√©diatement refl√©t√©es dans le navigateur!

## Pliny

La popularit√© du mod√®le s'explique en grande partie par sa personnalisation et son int√©gration avec d'autres services, des fournisseurs d'analyse aux solutions de commentaires. Cependant, cela signifie qu'une grande partie du code passe-partout doit √™tre colocalis√© dans le mod√®le m√™me si l'utilisateur n'utilise pas la fonctionnalit√©. Les mises √† jour et les corrections de bugs devaient √™tre copi√©es manuellement dans la base de code de l'utilisateur.

Pour r√©soudre ce probl√®me, j'ai r√©sum√© la logique dans un r√©pertoire s√©par√© - [Pline](https://github.com/timlrx/pliny). Pliny fournit des composants Next.js pr√™ts √† l'emploi pour am√©liorer les sites statiques¬†:

- Analytique
  - Google Analytics
  - Plausible Analytics
  - Simple Analytics
  - Umami Analytics
  - Posthog
- Commentaires
  - Disqus
  - Giscus
  - Utterances
- Newsletter (utilise l'API de routage de Next 13 )
  - Buttondown
  - Convertkit
  - Email Octopus
  - Klaviyo
  - Mailchimp
  - Revue
- Recherche de palette de commandes avec feuille de style tailwind
  - Algolia
  - Kbar (local search)
- Composants utilitaires de l'interface utilisateur
  - Bleed
  - Newsletter / Blog Newsletter
  - Pre / Code block
  - Table of Contents

Choisissez votre service pr√©f√©r√© en modifiant ¬´ siteMetadata.js ¬ª et en changeant les champs appropri√©s. Par exemple pour passer d'Umami Analytics √† Plausible, on peut modifier les champs suivants :

```diff-js:siteMetadata.js
analytics: {
-   umamiAnalytics: {
-     // We use an env variable for this site to avoid other users cloning our analytics ID
-     umamiWebsiteId: process.env.NEXT_UMAMI_ID, // e.g. 123e4567-e89b-12d3-a456-426614174000
-   },
+    plausibleAnalytics: {
+      plausibleDataDomain: '', // e.g. tailwind-nextjs-starter-blog.vercel.app
+    },
},
```

Les modifications apport√©es au fichier de configuration sont automatiquement propag√©es aux composants. Aucune modification du mod√®le n'est requise.

Sous le capot, Pliny exporte des composants de haut niveau tels que `<Analytics AnalyticsConfig={analyticsConfig}/>` et `<Comments commentsConfig={commentsConfig}/>` qui int√®grent un objet de configuration et restituent le composant appropri√©. √âtant donn√© que les mises en page sont d√©finies c√¥t√© serveur, Next.js est capable d'utiliser l'objet de configuration pour d√©terminer quel composant restituer et envoyer uniquement le paquet de composants requis au client.

## Nouveau composant de recherche

Qu'est-ce qu'un blog en 2023 sans barre de recherche avec palette de commandes?

L'une des fonctionnalit√©s les plus demand√©es a √©t√© ajout√©e üéâ! Le composant de recherche prend en charge 2 fournisseurs de recherche: Algolia et la recherche locale avec Kbar.

### Algolia

[Algolia Docsearch](https://docsearch.algolia.com/) est un service gratuit populaire utilis√© sur de nombreux sites Web de documentation. Il supprime automatiquement le site Web soumis √† l'indexation et rend le r√©sultat de la recherche disponible via une belle bo√Æte de dialogue modale. Le composant Pliny s'inspire grandement de l'impl√©mentation de Docusaurus et est livr√© avec une feuille de style compatible avec le th√®me CSS Tailwind.

### Kbar

[Kbar](https://github.com/timc1/kbar) est une interface cmd+k rapide, portable et extensible. L'impl√©mentation de Pliny utilise kbar pour cr√©er une bo√Æte de dialogue de recherche locale. Le composant charge un fichier JSON, ¬´ search.json ¬ª par d√©faut, qui a √©t√© cr√©√© lors du processus de cr√©ation de la couche de contenu. Essayez d'appuyer sur ‚åò-k ou ctrl-k pour voir la barre de recherche en action¬†!

## Mises √† jour du style et de la mise en page

### Th√®me

`tailwind.config.js` a √©t√© mis √† jour pour utiliser les valeurs par d√©faut de la typographie tailwind lorsque cela est possible et pour utiliser la prise en charge int√©gr√©e du mode sombre via la classe `prose-invert`. Cela remplace la classe et la configuration ¬´ prose-dark ¬ª pr√©c√©dentes.

La couleur du th√®me principal est mise √† jour de ¬´ teal ¬ª √† ¬´ pink ¬ª et le th√®me gris principal de ¬´ neutral ¬ª √† ¬´ gray ¬ª.

Inter est d√©sormais remplac√© par Space Grotesk comme police par d√©faut.

### Nouvelles mises en page

Les composants de mise en page disponibles dans le r√©pertoire ¬´ layouts ¬ª fournissent un moyen simple de personnaliser l'apparence du blog.[^2]

L'inconv√©nient de cr√©er un mod√®le populaire est que vous commencez √† voir plusieurs sites similaires partout üòÜ. Bien que les utilisateurs soient encourag√©s √† personnaliser les mises en page √† leur guise, le fait de disposer de plus d'options de mise en page facilement commutables favorise la diversit√© et peut peut-√™tre constituer un bon point de d√©part pour des personnalisations suppl√©mentaires.

Dans la v2, j'ai ajout√© une nouvelle mise en page de publication - `PostBanner`. Il comporte une grande image de banni√®re et un conteneur de contenu centr√©. Consultez le billet de blog ¬´¬†[Photos du Canada](/blog/images-du-canada)¬†¬ª qui a √©t√© mis √† jour pour utiliser la nouvelle mise en page.

La pr√©sentation par d√©faut de la liste des blogs a √©galement √©t√© mise √† jour pour inclure une barre lat√©rale avec des balises de blog. La barre de recherche dans la pr√©sentation pr√©c√©dente a √©t√© remplac√©e par la nouvelle recherche par palette de commandes. Pour revenir √† l'ancienne mise en page, remplacez simplement les pages qui utilisent le composant `ListLayoutWithTags` par la `ListLayout` d'origine.

## Recommandations de migration

En raison des changements importants dans la structure des r√©pertoires, la configuration et les outils, je recommande de partir d'un nouveau mod√®le et de copier le contenu existant, puis de migrer progressivement les modifications vers le nouveau mod√®le.

Les modifications de style doivent √™tre relativement mineures et peuvent √™tre copi√©es de l'ancien ¬´ tailwind.config.js ¬ª vers le nouveau. En cas de copie, vous devrez peut-√™tre rajouter la classe ¬´ prose-dark ¬ª aux composants qui optent pour le style typographique tailwind. Modifiez l'importation de polices dans le composant de mise en page racine pour utiliser la police souhait√©e.

Les modifications apport√©es au pipeline et au sch√©ma de traitement MDX peuvent √™tre facilement transf√©r√©es vers la nouvelle configuration Contentlayer. S'il y a des modifications dans les champs frontmatter, vous pouvez modifier le type de document dans ¬´ contentlayer.config.ts ¬ª pour inclure les nouveaux champs. Des plugins personnalis√©s peuvent √™tre ajout√©s aux propri√©t√©s `remarkPlugins` et `rehypePlugins` dans l'exportation `makeSource` de `contentlayer.config.ts`.

Les mises en page Markdown ne proviennent plus automatiquement du r√©pertoire ¬´ layouts ¬ª. Au lieu de cela, ils doivent √™tre sp√©cifi√©s dans l'objet `layouts` d√©fini dans `blog/[...slug]/page.tsx`.[^3]

Pour porter sur des composants ou des pages plus grandes, je recommande d'abord de le sp√©cifier en tant que composant client en utilisant la directive `"use client"`. Une fois le rendu correct, vous pouvez diviser les composants interactifs (parties qui reposent sur des hooks ¬´use¬ª) en tant que composant client et conserver le code restant en tant que composant serveur. Consultez le [guide de migration] Next.js complet (https://nextjs.org/docs/app/building-your-application/upgrading/app-router-migration#migrating-from-pages-to-app) pour plus de d√©tails .

## Conclusion

J'esp√®re que vous appr√©cierez les nouvelles fonctionnalit√©s et am√©liorations de la V2. Si vous avez des commentaires ou des suggestions, n'h√©sitez pas √† ouvrir un probl√®me ou √† me contacter sur [Twitter](https://twitter.com/timlrx).

## Support

Vous utilisez le mod√®le? Soutenez cet effort en attribuant une √©toile sur GitHub, en partageant votre propre blog et en criant sur Twitter ou en devenant un [sponsor] du projet (https://github.com/sponsors/timlrx).

## Licence

[MIT](https://github.com/timlrx/tailwind-nextjs-starter-blog/blob/main/LICENSE) ¬© [Timothy Lin](https://www.timrlx.com)

[^1]: La version pr√©c√©dente injecte Preact dans la version de production. Cependant, cela n'est plus possible car il ne prend pas en charge les composants React Server. Alors que la taille globale du bundle a augment√© jusqu'√† environ 85 Ko, la plupart du contenu peut √™tre pr√©-rendu c√¥t√© serveur, ce qui se traduit par un premier rendu de contenu et un temps d'interactivit√© faibles. L'utilisation globale de React conduit √©galement √† un comportement plus coh√©rent avec les biblioth√®ques et les composants externes.
[^2]: Ceci est diff√©rent des mises en page du r√©pertoire d'applications Next.js et est mieux consid√©r√© comme des composants React r√©utilisables.
[^3]: Cela tire parti des composants serveur en simplifiant la sp√©cification de la mise en page de votre choix dans le fichier markdown et la comparaison avec l'objet `layouts` qui est ensuite utilis√© pour restituer le composant de mise en page appropri√©.
